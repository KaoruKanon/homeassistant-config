light:
  - platform: group
    name: CHAMBRE
    entities:
      [
        "light.yeelight_stripe",
        "light.plafond_1",
        "light.plafond_2",
        "light.lampe_japonaise",
      ]

  - platform: group
    name: BUREAU
    entities: ["light.yeelight_stripe", "light.lampe_japonaise"]

  - platform: group
    name: PLAFOND
    entities: ["light.plafond_1", "light.plafond_2"]

  - platform: group
    name: SALON
    entities: ["light.salon_1", "light.salon_2"]

  - platform: group
    name: MAISON
    entities:
      [
        "light.yeelight_stripe",
        "light.plafond_1",
        "light.plafond_2",
        "light.lampe_japonaise",
        "light.salon_1",
        "light.salon_2",
      ]

template:
  - sensor:
      - name: "Total Lights Count Template"
        state: "{{ states.light | rejectattr('attributes.entity_id', 'defined') | selectattr('state', 'eq', 'on') | rejectattr('attributes.type', 'equalto', 'browser_mod') | list | count }}"

automation:
  - alias: toggle_bureau
    trigger:
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_1
          click_type: single
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_2
          click_type: single
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_3
          click_type: single
    condition: []
    action:
      - action: light.toggle
        target:
          entity_id: light.bureau
    mode: single

  - alias: toggle_plafond
    trigger:
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_1
          click_type: double
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_2
          click_type: double
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_3
          click_type: double
    condition: []
    action:
      - action: light.toggle
        target:
          entity_id: light.plafond

  - alias: allumer_chambre
    trigger:
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_1
          click_type: long_click_press
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_2
          click_type: long_click_press
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_3
          click_type: long_click_press
    condition:
      - condition: state
        state: "off"
        entity_id: light.chambre
    action:
      - action: light.turn_on
        target:
          entity_id: light.chambre
    mode: single

  - alias: eteindre_chambre
    trigger:
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_1
          click_type: long_click_press
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_2
          click_type: long_click_press
      - trigger: event
        event_type: xiaomi_aqara.click
        event_data:
          entity_id: binary_sensor.switch_3
          click_type: long_click_press
    condition:
      - condition: state
        state: "on"
        entity_id: light.chambre
    action:
      - action: light.turn_off
        target:
          entity_id: light.chambre
