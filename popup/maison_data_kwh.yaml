              action: fire-dom-event
              browser_mod:
                command: popup
                title: "La consommation électrique en kWh"
                style: ':host .content {width: 38em;}'
                card:
                  type: custom:stack-in-card
                  cards:

                    - type: horizontal-stack
                      cards:
                        - type: entities
                          entities:
                            - entity: sensor.enedis_kwh_year
                          style: |
                            :host {
                            --paper-item-icon-color: #405914;
                             }
                            ha-card {
                            margin-left: 50%;
                             }

                        - type: entities
                          entities:
                            - entity: sensor.enedis_kwh_last_year
                          style: |
                            :host {
                            --paper-item-icon-color: #323637;
                             }

                    - type: custom:mod-card
                      style: |
                        ha-card {
                          padding: 0em 3em 0em 1.2em;
                          margin-top: -1em;
                          margin-bottom: -1.5em;
                        }
                      card:
                        type: horizontal-stack
                        cards:

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_1
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[0].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[0].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_2
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[1].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[1].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_3
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[2].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[2].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_4
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[3].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[3].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_5
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[4].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[4].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_6
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[5].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[5].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_7
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[6].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[6].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_8
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[7].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[7].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_9
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[8].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[8].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_10
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[9].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[9].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_11
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[10].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[10].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                          - type: custom:bar-card
                            entity: sensor.enedis_kwh_12
                            color: 'var(--kwh_bar)'
                            max: 423
                            direction: up
                            positions:
                              icon: off
                            height: 18em
                            width: 1.8em
                            style: |
                              :host {
                                {% if strptime(states('sensor.enedis_kwh').split(',')[11].split(' ')[1], '%Y').split('-')[0] |
                                int >= strptime(states('sensor.date').split(',')[0].split(' ')[0], '%Y').split('-')[0] | int %}
                                --kwh_bar: #405914;
                                {% else %}
                                --kwh_bar: #323637;
                                {% endif %}
                                --pos: {{ states('sensor.enedis_kwh').split(',')[11].split(' ')[2] | int /23 }}em;
                              }
                              bar-card-name, bar-card-iconbar {
                                padding-left: 0 !important;
                              }
                              bar-card-bar, bar-card-chargebar, bar-card-indicatorbar,
                              bar-card-indicatorcontainer, bar-card-indicator {
                                border-radius: .3em;
                              }
                              bar-card-value {
                                color: var(--kwh_bar) !important;
                                filter: brightness(1.5);
                                font-size: 1em;
                                text-shadow: none;
                                font-weight: 500 !important;
                                margin-bottom: var(--pos);
                                margin-left: auto;
                              }
                              bar-card-background {
                                background: none !important;
                                box-shadow: none !important;
                              }
                              bar-card-title {
                                overflow: visible;
                                margin-left: auto;
                                margin-top: -1.5em;
                              }

                    - type: horizontal-stack
                      cards:
                        - type: entities
                          entities:
                            - entity: sensor.enedis_kwh_last_month_last_year_kwh
                            - entity: sensor.enedis_kwh_diff_last_month_and_last_year
                          style: |
                            ha-card {
                              margin-bottom: 1.5em
                            }


                        - type: entities
                          entities:
                            - entity: sensor.enedis_kwh_last_month_price
                            - entity: sensor.enedis_kwh_total_year_kwh
                          style: |
                            ha-card {
                              margin-bottom: 1.5em
                            }


                    - type: custom:hui-element
                      card_type: horizontal-stack
                      card_mod:
                        style: |
                          #root {
                            justify-content: space-evenly;
                            margin: 1em 0 1em 0;
                          }
                      cards:

                      - type: custom:button-card
                        name: Mettre à jour la consommation
                        icon: mdi:refresh
                        tap_action:
                          action: call-service
                          service: script.refresh_kwh_consumption

                          # - service: homeassistant.update_entity
                          #   entity_id: sensor.myenedis_01134587449350
                          # - service: homeassistant.shell_command
                          #   entity_id: enedis_update_data
                        style: |
                          ha-card {
                            margin-top: -1em;
                            margin-left: 45%;
                            margin-bottom: 1em;
                            background: #2e3333 !important;
                            border-radius: 0.6em !important;
                          }
                        template:
                          - icon_name
